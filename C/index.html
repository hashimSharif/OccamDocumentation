<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Occam - Application Specialization: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Occam - Application Specialization
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces (C++)</span></a></li>
      <li><a href="annotated.html"><span>Classes (C++)</span></a></li>
      <li><a href="files.html"><span>Files (C++)</span></a></li>
	  <li><a href="../python/index.html"><span> Occam Python Documentation</span></a></li>  
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Occam - Application Specialization Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>Introduction: </h2>
<p>Occam is a previrtualization/monitoring tool chain based on LLVM. Previrtualization refers to:</p>
<p>1) Reducing unpredictable program behaviour, with specializing with respect to static program arguments,</p>
<p>2) Creating specialized versions of functions taking constant arguments,</p>
<p>3) Eliminating unused code (Dead code elimination).</p>
<p>Occam provides a variety of tools for partial evaluation, previrtualization, dead code elimination, and implementing watch functions. Importantly the previrt tool, performs comprehensive previrtualization; a process applying a number of passes, including program argument specialization, intra-module specialization, inter-module specialization and dead code elimination. The tool takes as input a manifest file, that lists :</p>
<p>1) The libraries required by the program</p>
<p>2) The search path</p>
<p>3) The name of the previrtualized binary</p>
<p>4) The bitcode modules comprising the application</p>
<p>5) The static arguments to the program</p>
<hr/>
 <h2>Architecture Diagram </h2>
<div class="image">
<img src="Architecture.png" alt="Architecture.png"/>
</div>
<p>The Python classes form the starting point of the application. The Python wrappers contain a number of available tools, important ones including <em>interface</em>, <em>peval</em>, <em>specialize</em>, <em>rewrite</em>, <em>previrt</em>. These tools can be found under the folder OccamRoot/tools/occam/occam/targets. The Python modules are essentially wrappers over the C++ Classes that extend llvm <a class="el" href="class_module_pass.html">ModulePass</a>. The C++ classes, each implementing a specific Pass, are all compiled and linked together into one runtime library namely libprevirt.so . The C++ files can be found under the folder OccamRoot/src. The Python wrappers create a new Process loading the <em>opt</em> program (llvm). Opt loads the libprevirt.so runtime library to extend its available passes, incorporating the ones defined in the library. Communication between the C++ library and Python wrappers is achieved via <em>Google</em> <em>Protocol</em> <em>Buffers</em>. The Python and C++ components both include the <em>Google</em> <em>Protocol</em> <em>Buffer</em> data access classes , to read and write data to the serialized <em>Protocol</em> <em>Buffer</em> files.</p>
<hr/>
 <h2>Program Argument Specialization </h2>
<p>Program argument specialization replaces the references to argc, and argv[] array in the program with global variables containing static values. The concept is well illustrated with the following example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> a=atoi(argv[1]);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d&quot;</span>,a);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If argv[1] is mapped onto '2', the previous program can be specialized onto:</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> * global=<span class="stringliteral">&quot;2&quot;</span>;    </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])   </div>
<div class="line">{   </div>
<div class="line">    <span class="keywordtype">int</span> number = atoi(global);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d&quot;</span>,number);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}                                   </div>
</div><!-- fragment --><p>The program argument specialization phase is implemented in the class <a class="el" href="classprevirt_1_1_register_arguments.html">previrt::RegisterArguments</a>.</p>
<p>Note: Specialization is applied only once the code is translated to LLVM IR. The examples in C are used merely for demonstration. </p>
<hr/>
 <h2>Partial Evaluation (Intra-Module Specialization): </h2>
<p>The partial evaluation tool <em>peval</em>, provides intra-module specialization, creating specialized versions of functions, based on their specific usages within the module. The principle of previrtualization is centered on analysing the call-sites to functions.If a call-site taking up constant values, a new cloned version of the 'callee' is created (using LLVM's cloneFunction routine), incorporating the value of the argument directly into the function body. As an examples consider the following call instruction to the function 'add':</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> add(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> a+b;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> sum=add(3,4)</div>
<div class="line">  return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>As both the arguments are constants, a cloned copy of the function 'add' is created with a new unique name, that simply returns 7 (the sum of 3 and 4), without taking any arguments. The respective call-site is also modified. Hence the modified program would look like:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> add(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b)  <span class="comment">// Note: The original function is not removed from the module</span></div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> a+b;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> new_add()         <span class="comment">// the name assigned in this example is arbitrary, more relevant function names are generated </span></div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> 7;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> sum=new_add();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The partial evaluation phase is implemented in the Class <a class="el" href="classanonymous__namespace_02_strategy_specializer_8cpp_03_1_1_par_eval_opt_pass.html">ParEvalOptPass</a> </p>
<hr/>
 <h2>Inter-Module Specialization (Previrt) </h2>
<p>Inter-Module specialization is performed using the <em>previrt</em> Tool. The procedure is comparatively more elaborate to intra-module specialization due to the fact that all the LLVM passes apply only to a single module, therefore a number of passes are required over all modules in order to create specialized versions of functions and rewrite all the corresponding call-sites.</p>
<p>The <em>previrt</em> tool specializes the application with respect to a given manifest file. The manifest file specifies binary, modules, search path and libraries. The <em>previrt</em> tool goes through the following steps:</p>
<p>1) Specializes the program with respect to command line arguments.</p>
<p>2) Partial Evaluation (intra module specialization).</p>
<p>3) InterModule Specialization: </p>
<ul>
<li>
Collecting External References (implemented in the class <a class="el" href="classprevirt_1_1_gather_interface2_pass.html">previrt::GatherInterface2Pass</a>)  </li>
<li>
Specializing the functions based on their specific usages - creating specialized versions of the functions (implemented in the class <a class="el" href="classanonymous__namespace_02_specialize_component_8cpp_03_1_1_specialize_component_pass.html"> SpecializeComponentPass )</a> </li>
<li>
Specializing Call-sites - Rewriting calls to specialized versions (implemented in the class <a class="el" href="classprevirt_1_1_rewrite_component_pass.html">previrt::RewriteComponentPass</a> )  </li>
</ul>
<p>4) Dead code elimination.</p>
<p>5) Recomputing Reference interfaces (more dead code produced as a result of functions removed).</p>
<p>6) Repeating Dead code elimination.</p>
<p>7) Linking the modules together with llvm-ld. </p>
<hr/>
 <h2>Recursive Guard Specialization Policy </h2>
<p>Recursive functions are an exception to the specialization process. Recursive functions need to be identified in the Module and be exempted from specialization. The following code snippet illustrates the reason of doing so:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> recursiveFunction(<span class="keywordtype">int</span> *arr, <span class="keywordtype">int</span> i)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(i &lt; 10)</div>
<div class="line">    {</div>
<div class="line">      processArr(arr,i);</div>
<div class="line">      recursiveFunction(arr,++i);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> * arr = <span class="keyword">new</span> <span class="keywordtype">int</span>[10];</div>
<div class="line">   recursiveFunction(arr,0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Trying to specialize the function 'recursiveFunction' would result in creating a copy of 'recursiveFunction' with the argument 'i' replaced with the value '0'. Doing so, would result in the function taking the form:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> new_recursiveFunction(<span class="keywordtype">int</span> *arr)</div>
<div class="line">{  </div>
<div class="line">     processArr(arr,0);</div>
<div class="line">     recursiveFunction(arr,1);</div>
<div class="line">}</div>
</div><!-- fragment --><p>As 'new_recursiveFunction' is taking another constant value '1', it would need to be specialized again, therefore 10 different copies of the function would be created, unnecessarily increasing the size of the program executable. Hence we do not specialize recursive functions. The procedure of guarding recursive functions is implemented in the class <a class="el" href="classprevirt_1_1_recursive_guard_spec_policy.html">previrt::RecursiveGuardSpecPolicy</a>. </p>
<hr/>
 <h2>REGISTRATION OF TOOLS: </h2>
<p>In the C++ Code Each Class extending the <em><a class="el" href="class_module_pass.html">ModulePass</a></em> (llvm), registers itself using the <em>RegisterPass</em> (llvm) Class to announce the availability of a new pass by adding it to the internal database maintained by the <em>PassManager</em>. The <em>opt</em> tool can now invoke the newly created pass. The pass names in the RegisterPass constructor, correspond to the names given as parameter to <em>opt</em> when the tool is to be used. </p>
<hr/>
 <h2>Mapping Of Python tools to Library Classes and Program Flow</h2>
<p>Some Python modules in the /tools/occam/occam/targets directory are wrappers over llvm tools. They include <em>ar</em>, <em>arlink</em>, <em>arg</em>, <em>argparse</em>, <em>pack</em>, <em>build</em>, <em>clang</em> , <em>install</em>. Other Modules are wrappers over the libprevirt.so previrtualization runtime library, providing services including partial evaluation (<em>peval</em>), program specialization (<em>Parguments</em>), dead code elimination (<em>Poccam</em>), and watch functions (<em>Pwatch2</em>)</p>
<p>The usage of <em>Occam</em> with the tool <em>previrt</em> is illustrated with the following example.</p>
<p>occam previrt &ndash;work-dir = $WORKDIR $MANIFEST_FILE</p>
<p>The command above invokes the file <em>OccamRoot/tools/occam/occam2</em>. <em>Occam2</em> invokes the <em>OccamRoot/tools/occam/occam/target.py</em> file that in turn calls the appropriate tool depending on the command line argument requesting the tool. In the example command above, the requested tool is <em>previrt</em>. Taking <em>previrt</em> as an example, the <em>target.py</em> file invokes the <em>run</em> method (containing the pass implementation) of the <em>PrevirtTool</em> Class implemented in the file <em>OccamRoot/tools/occam/occam/targets/previrt.py</em>. Similarly for any other tool, <em>target.py</em> invokes the corresponding file in the <em>OccamRoot/tools/occam/occam/targets</em> folder.</p>
<p>Most Python tools in the <em>targets</em> folder are wrappers above the C++ Passes. The mapping of important python wrappers to C++ Passes is listed below:</p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1peval_1_1_partial_eval_tool.html"> PartialEvalTool </a>   ---&gt; <a class="el" href="classanonymous__namespace_02_strategy_specializer_8cpp_03_1_1_par_eval_opt_pass.html">ParEvalOptPass</a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1interface_1_1_interface_tool.html"> InterfaceTool   </a>   ---&gt; <a class="el" href="classprevirt_1_1_gather_interface2_pass.html">previrt::GatherInterface2Pass</a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1specialize_1_1_specialize_tool.html"> SpecializeTool  </a>   ---&gt; <a class="el" href="classanonymous__namespace_02_specialize_component_8cpp_03_1_1_specialize_component_pass.html"> SpecializeComponentPass </a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1rewrite_1_1_rewrite_tool.html"> RewriteTool     </a>   ---&gt; <a class="el" href="classprevirt_1_1_rewrite_component_pass.html">previrt::RewriteComponentPass</a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1previrt_1_1_previrt_tool.html"> PrevirtTool     </a>   ---&gt; <a class="el" href="classprevirt_1_1_watch_pass2.html">previrt::WatchPass2</a> , <a class="el" href="classprevirt_1_1_gather_interface2_pass.html">previrt::GatherInterface2Pass</a>,<a class="el" href="classanonymous__namespace_02_specialize_component_8cpp_03_1_1_specialize_component_pass.html"> SpecializeComponentPass </a>, <a class="el" href="classprevirt_1_1_rewrite_component_pass.html">previrt::RewriteComponentPass</a> , <a class="el" href="classprevirt_1_1_occam_pass.html">previrt::OccamPass</a> , <a class="el" href="classprevirt_1_1_watch_pass2.html">previrt::WatchPass2</a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1watch_1_1_watch_tool.html"> WatchTool       </a>   ---&gt; <a class="el" href="classprevirt_1_1_watch_pass2.html">previrt::WatchPass2</a></p>
<p><a class="el" href="../python/classoccam_1_1targets_1_1slice_1_1_slice_tool.html"> SliceTool       </a>   ---&gt; <a class="el" href="classprevirt_1_1_occam_pass.html">previrt::OccamPass</a></p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 27 2013 00:22:31 for Occam - Application Specialization by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
